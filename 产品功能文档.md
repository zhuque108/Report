# 儿童身高发育管理测评报告系统 - 产品功能文档

## 文档说明

本文档为儿童身高发育管理测评报告系统的完整产品功能说明。包含系统功能、用户流程、数据结构、报告样式规范等内容。本文档用于指导开发人员1:1还原系统功能和报告视觉效果。

**文档版本**：v1.0
**最后更新**：2024年
**严谨性要求**：★★★★★（最高级别，报告内容和样式必须1:1还原）

---

## 第一部分：产品概述

### 1.1 产品定义

**产品名称**：儿童身高发育管理测评报告系统

**产品定位**：专业的儿童身高发育评估与管理平台，通过科学的数据采集、分析和可视化，为家长和医疗专业人士提供个性化的身高管理方案。

**核心价值主张**：
- 科学监测：基于WHO标准的专业评估
- 助力成长：个性化的干预建议
- 让孩子多长10厘米：通过综合管理实现身高增长目标

### 1.2 产品目标用户

- **主要用户**：儿童家长（年龄25-45岁）
- **次要用户**：儿科医生、营养师、健康管理师
- **使用场景**：家庭健康管理、医疗机构评估、健康咨询

### 1.3 技术架构

- **前端框架**：Next.js 16.1.1 + React 19
- **UI组件库**：shadcn/ui（基于Radix UI）
- **样式框架**：Tailwind CSS v4
- **数据可视化**：Recharts
- **表单处理**：React Hook Form + Zod
- **PDF导出**：html2canvas + jsPDF
- **数据存储**：浏览器sessionStorage（前端演示版）

---

## 第二部分：核心功能模块

### 2.1 功能模块概览

系统包含以下核心功能模块：

| 模块 | 功能 | 用户 | 优先级 |
|------|------|------|--------|
| 首页 | 品牌展示、功能介绍、入口导航 | 所有用户 | P0 |
| 表单提交 | 数据采集、验证、处理 | 家长/医生 | P0 |
| 报告生成 | 数据分析、报告渲染 | 所有用户 | P0 |
| PDF导出 | 报告导出为PDF文件 | 所有用户 | P1 |
| 打印功能 | 浏览器打印功能 | 所有用户 | P1 |

### 2.2 用户完整流程

```
┌─────────────────────────────────────────────────────────────┐
│                    首页 (/)                                  │
│  - 品牌展示与Slogan                                         │
│  - 功能介绍卡片（3个）                                      │
│  - 两个主要按钮：填写测评 / 查看示例                        │
└────────────┬──────────────────────────────┬─────────────────┘
             │                              │
    [填写测评信息]                  [查看示例报告]
             │                              │
             ▼                              ▼
    ┌──────────────────────┐      ┌──────────────────────┐
    │  表单提交页面        │      │  示例报告页面        │
    │  (/submit)           │      │  (/report/sample-001)│
    │                      │      │                      │
    │ 1. 基本信息          │      │ 1. 导航栏            │
    │ 2. 身体数据          │      │ 2. 报告内容          │
    │ 3. 遗传背景          │      │ 3. 操作按钮          │
    │ 4. 健康问题          │      │                      │
    │ 5. 改善意愿          │      │ 功能：                │
    │ 6. 医生建议          │      │ - 分页浏览            │
    │                      │      │ - PDF导出             │
    │ [提交]               │      │ - 打印                │
    └──────────┬───────────┘      └──────────────────────┘
               │
               ▼
    ┌──────────────────────────────────────────┐
    │  数据处理与计算                          │
    │  - 年龄计算                              │
    │  - BMI计算                               │
    │  - 遗传靶身高计算                        │
    │  - 生长记录生成                          │
    │  - 成年身高预测                          │
    │  - 健康因素分析                          │
    │  - 综合评级                              │
    │  - 个性化建议生成                        │
    └──────────┬───────────────────────────────┘
               │
               ▼
    ┌──────────────────────────────────────────┐
    │  报告页面 (/report/{reportId})           │
    │  - 导航栏                                │
    │  - 6页完整报告                           │
    │  - 操作按钮（PDF导出、打印）             │
    └──────────┬───────────────────────────────┘
               │
        ┌──────┴──────┐
        │             │
        ▼             ▼
    [PDF导出]    [打印]
        │             │
        ▼             ▼
    PDF文件    打印对话框
```

---

## 第三部分：表单提交功能详细说明

### 3.1 表单页面概览

**页面路由**：`/submit`
**页面标题**：儿童身高发育管理 - 填写测评信息
**页面布局**：单列布局，最大宽度800px，居中显示

### 3.2 表单数据字段完整定义

#### 3.2.1 基本信息部分

**部分标题**：基本信息

| 字段名 | 字段类型 | 必填 | 验证规则 | 说明 |
|--------|---------|------|---------|------|
| childName | 文本输入 | 是 | 长度2-50字符 | 儿童姓名 |
| gender | 单选按钮 | 是 | male / female | 性别选择 |
| birthDate | 日期选择器 | 是 | 有效日期，不超过今天 | 出生日期（YYYY-MM-DD） |
| assessmentDate | 日期选择器 | 否 | 有效日期，默认今天 | 测评日期（YYYY-MM-DD） |

**UI样式**：
- 标签字体：14px，#666666
- 输入框高度：40px
- 输入框边框：1px solid #E0E0E0
- 输入框圆角：4px
- 焦点状态：边框色变为#2A5C8E，阴影#2A5C8E20

#### 3.2.2 身体数据部分

**部分标题**：身体数据

| 字段名 | 字段类型 | 必填 | 验证规则 | 单位 | 说明 |
|--------|---------|------|---------|------|------|
| currentHeight | 数字输入 | 是 | 30-200 | cm | 当前身高 |
| currentWeight | 数字输入 | 是 | 2-150 | kg | 当前体重 |
| annualHeightGrowth | 数字输入 | 是 | 0-30 | cm/年 | 年身高增长值 |

**输入框配置**：
- 类型：number
- 最小值/最大值：根据验证规则
- 步长：0.1
- 后缀显示：单位（cm、kg等）

#### 3.2.3 遗传背景部分

**部分标题**：遗传背景

| 字段名 | 字段类型 | 必填 | 验证规则 | 单位 | 说明 |
|--------|---------|------|---------|------|------|
| fatherHeight | 数字输入 | 是 | 140-220 | cm | 父亲身高 |
| motherHeight | 数字输入 | 是 | 130-200 | cm | 母亲身高 |
| gestationalWeeks | 数字输入 | 是 | 28-42 | 周 | 出生孕周 |

**提示信息**：
- 父亲身高：请输入父亲的实际身高
- 母亲身高：请输入母亲的实际身高
- 出生孕周：少于37周为早产

#### 3.2.4 健康问题部分

**部分标题**：最困扰的问题（可多选，1-3项）

| 选项 | 值 | 说明 |
|------|-----|------|
| 挑食 | picky_eating | 饮食不均衡 |
| 晚睡 | late_sleep | 睡眠时间不足 |
| 不爱运动 | lack_exercise | 运动量不足 |
| 情绪问题 | emotion_issue | 心理压力大 |
| 厌食 | anorexia | 食欲不振 |
| 过度喂养 | overfeeding | 营养过剩 |

**UI样式**：
- 复选框样式：Checkbox组件
- 选中颜色：#2A5C8E
- 最多选择：3项
- 超过3项时：提示"最多选择3项"

#### 3.2.5 改善意愿部分

**部分标题**：家长改善意愿强度

| 选项 | 值 | 说明 |
|------|-----|------|
| 高 | high | 非常想改善，愿意付出努力 |
| 中 | medium | 想改善，但需要指导 |
| 低 | low | 不太确定，需要了解更多 |

**UI样式**：
- 单选按钮组
- 选中颜色：#2A5C8E
- 卡片式布局，每个选项占一行

#### 3.2.6 可选部分

**部分标题**：医生建议（可选）

| 字段名 | 字段类型 | 必填 | 验证规则 | 说明 |
|--------|---------|------|---------|------|
| doctorAdvice | 文本域 | 否 | 最多500字 | 医生或专业人士的建议 |

**UI样式**：
- 文本域高度：120px
- 字体大小：14px
- 行高：1.5
- 占位符：请输入医生或专业人士的建议...

### 3.3 表单提交流程

**提交按钮**：
- 文本：提交测评
- 颜色：#2A5C8E（深蓝）
- 宽度：100%
- 高度：48px
- 字体大小：16px
- 悬停效果：背景色变深，阴影增加

**提交流程**：

```
1. 用户点击[提交测评]按钮
   ↓
2. 前端验证所有必填字段
   - 如果验证失败 → 显示错误提示，不提交
   - 如果验证成功 → 继续
   ↓
3. 执行数据处理和计算
   - 计算年龄
   - 计算BMI
   - 计算遗传靶身高
   - 生成生长记录
   - 预测成年身高
   - 分析健康因素
   - 生成综合评级
   - 生成个性化建议
   ↓
4. 生成报告ID
   格式：GHT-YYYYMMDD-XXXX
   例如：GHT-20241215-A1B2
   ↓
5. 将完整报告数据存储到sessionStorage
   Key: report-{reportId}
   Value: JSON格式的报告数据
   ↓
6. 显示成功提示
   "测评完成！正在为您生成报告..."
   ↓
7. 重定向到报告页面
   /report/{reportId}
```

### 3.4 数据验证规则

**客户端验证**（实时反馈）：

```javascript
// 基本信息验证
childName: 必填，长度2-50
gender: 必填，值为male或female
birthDate: 必填，有效日期，不超过今天
assessmentDate: 可选，有效日期，默认今天

// 身体数据验证
currentHeight: 必填，30-200之间
currentWeight: 必填，2-150之间
annualHeightGrowth: 必填，0-30之间

// 遗传背景验证
fatherHeight: 必填，140-220之间
motherHeight: 必填，130-200之间
gestationalWeeks: 必填，28-42之间

// 健康问题验证
mainIssues: 可选，最多3项

// 改善意愿验证
willingness: 必填，值为high/medium/low

// 医生建议验证
doctorAdvice: 可选，最多500字
```

---

## 第四部分：数据处理与计算规则

### 4.1 年龄计算

**计算公式**：
```
实足年龄 = 测评日期 - 出生日期

返回值：
{
  years: 整数（岁）,
  months: 整数（月，0-11）,
  totalMonths: 整数（总月数）,
  totalDays: 整数（总天数）
}

显示格式：X岁X个月
```

**示例**：
- 出生日期：2015-06-15
- 测评日期：2024-12-15
- 计算结果：9岁6个月

### 4.2 BMI计算与状态判断

**计算公式**：
```
BMI = 体重(kg) / (身高(m))²

示例：
体重：30kg，身高：120cm
BMI = 30 / (1.2)² = 30 / 1.44 = 20.83
```

**BMI状态判断**（儿童标准）：

| BMI范围 | 状态 | 颜色 | 说明 |
|---------|------|------|------|
| < 18.5 | 偏瘦 | #FF6B6B（红色） | 需要加强营养 |
| 18.5-24.9 | 正常 | #51CF66（绿色） | 生长发育正常 |
| 25-29.9 | 超重 | #FFA726（橙色） | 需要控制饮食 |
| ≥ 30 | 肥胖 | #EF5350（深红） | 需要医学干预 |

**显示格式**：
```
BMI: 20.8
状态: 正常 ✓
```

### 4.3 遗传靶身高计算

**计算公式**：
```
男孩遗传靶身高 = (父亲身高 + 母亲身高 + 13) / 2
女孩遗传靶身高 = (父亲身高 + 母亲身高 - 13) / 2

遗传身高范围 = 靶身高 ± 8.5cm
```

**示例**：
```
父亲身高：175cm
母亲身高：162cm
男孩靶身高 = (175 + 162 + 13) / 2 = 175cm
遗传范围 = 166.5-183.5cm

女孩靶身高 = (175 + 162 - 13) / 2 = 162cm
遗传范围 = 153.5-170.5cm
```

**返回值**：
```javascript
{
  targetHeight: 175,           // 靶身高
  minHeight: 166.5,            // 最小值
  maxHeight: 183.5,            // 最大值
  range: "166.5-183.5cm"       // 范围字符串
}
```

### 4.4 生长记录生成

**规则**：
- 为每个年龄（0-18岁）生成一条生长记录
- 当前年龄使用实际输入的身高数据
- 半年前的记录 = 当前身高 - 年增长值/2
- 其他年龄使用WHO标准数据

**生成逻辑**：
```javascript
const growthRecords = [];

for (let age = 0; age <= 18; age++) {
  if (age === currentAge) {
    // 当前年龄：使用实际输入数据
    growthRecords.push({
      age: currentAge,
      height: currentHeight,
      weight: currentWeight,
      source: 'actual'
    });
  } else if (age === currentAge - 0.5) {
    // 半年前：计算值
    growthRecords.push({
      age: currentAge - 0.5,
      height: currentHeight - annualHeightGrowth / 2,
      weight: currentWeight - 2,  // 估算
      source: 'calculated'
    });
  } else {
    // 其他年龄：WHO标准数据
    growthRecords.push({
      age: age,
      height: WHO_STANDARD[gender][age],
      weight: WHO_STANDARD[gender][age],
      source: 'who_standard'
    });
  }
}
```

### 4.5 成年身高预测

**预测方法**：基于WHO百分位追踪算法

**步骤**：
```
1. 根据当前年龄和身高，确定当前百分位
   - 查询WHO标准数据表
   - 找到最接近的百分位（P3, P10, P25, P50, P75, P90, P97）

2. 假设百分位保持不变，推算18岁时的身高
   - 查询18岁时该百分位的身高值

3. 计算预测范围
   - 预测身高 ± 5cm 作为波动范围
```

**示例**：
```
当前年龄：10岁
当前身高：140cm
性别：男孩

查询WHO标准：
- 10岁男孩P50 = 138cm
- 10岁男孩P75 = 145cm
- 当前身高140cm接近P50-P75之间

推算18岁：
- 18岁男孩P50 = 175cm
- 18岁男孩P75 = 182cm
- 预测身高 ≈ 178cm

预测范围：173-183cm
```

**返回值**：
```javascript
{
  predictedHeight: 178,        // 预测身高
  minHeight: 173,              // 最小值
  maxHeight: 183,              // 最大值
  currentPercentile: "P50-P75", // 当前百分位
  confidence: 0.85             // 置信度（0-1）
}
```

### 4.6 健康因素分析

**根据选中的问题生成对应的健康因素数据**：

#### 4.6.1 睡眠因素（晚睡）

```javascript
if (mainIssues.includes('late_sleep')) {
  sleep = {
    issue: '晚睡',
    currentBedtime: '22:30',      // 当前入睡时间
    recommendedBedtime: '21:00',  // 建议入睡时间
    currentSleepHours: 7,         // 当前睡眠时长
    recommendedSleepHours: 9,     // 建议睡眠时长
    impact: '生长激素分泌减少，影响身高增长',
    advice: '建议每晚21:00前入睡，保证9小时睡眠'
  };
}
```

#### 4.6.2 营养因素（挑食/厌食/过度喂养）

```javascript
if (mainIssues.includes('picky_eating')) {
  nutrition = {
    issue: '挑食',
    proteinIntake: 'low',        // 蛋白质摄入：低
    calciumIntake: 'low',        // 钙质摄入：低
    micronutrients: 'imbalanced', // 微量元素：不均衡
    impact: '营养结构不均衡，影响骨骼发育',
    advice: '增加蛋白质、钙质、锌等营养摄入'
  };
}
```

#### 4.6.3 运动因素（不爱运动）

```javascript
if (mainIssues.includes('lack_exercise')) {
  exercise = {
    issue: '不爱运动',
    currentFrequency: 'low',     // 当前运动频率：低
    recommendedFrequency: 'daily', // 建议频率：每日
    currentDuration: 0,          // 当前运动时长：0分钟
    recommendedDuration: 30,     // 建议运动时长：30分钟
    impact: '缺乏运动刺激，骨骼强度不足',
    advice: '每日进行30分钟中高强度运动'
  };
}
```

#### 4.6.4 情绪因素（情绪问题）

```javascript
if (mainIssues.includes('emotion_issue')) {
  emotion = {
    issue: '情绪问题',
    stressLevel: 'high',         // 压力水平：高
    emotionalState: 'unstable',  // 情绪状态：不稳定
    impact: '心理压力影响生长激素分泌',
    advice: '建议进行心理疏导，保持心情舒畅'
  };
}
```

### 4.7 综合评级规则

**评级标准**：

| 评级 | 条件 | 颜色 | 文字描述 | 详细说明 |
|------|------|------|---------|---------|
| A | 问题数 = 0 | #51CF66（绿色） | 优秀 | 生长发育状况非常好，继续保持 |
| B | 问题数 = 1 | #2196F3（蓝色） | 良好 | 生长发育状况良好，需要微调 |
| C | 问题数 ≥ 2 | #FFA726（橙色） | 预警 | 需要关注和干预，改善空间大 |
| D | 预测身高 < 遗传最小值 | #EF5350（红色） | 矮小风险 | 建议专业医疗介入 |

**评级逻辑**：
```javascript
function getOverallRating(mainIssues, predictedHeight, geneticMinHeight) {
  // 首先检查是否有矮小风险
  if (predictedHeight < geneticMinHeight) {
    return 'D';  // 矮小风险
  }

  // 根据问题数量评级
  const issueCount = mainIssues.length;
  if (issueCount === 0) {
    return 'A';  // 优秀
  } else if (issueCount === 1) {
    return 'B';  // 良好
  } else {
    return 'C';  // 预警
  }
}
```

### 4.8 个性化建议生成

**建议包含四个维度**：

#### 4.8.1 饮食建议

```javascript
const nutritionAdvice = {
  title: '饮食建议',
  icon: 'Apple',
  color: '#51CF66',
  items: [
    '增加高蛋白食物：鸡蛋、牛奶、鱼类、瘦肉等',
    '补充钙质：牛奶、酸奶、豆制品、绿叶蔬菜',
    '补充锌：牡蛎、瘦肉、坚果、全谷物',
    '均衡膳食：五谷杂粮、蔬菜水果、肉类蛋白',
    '避免过量糖分和油脂'
  ]
};
```

#### 4.8.2 睡眠建议

```javascript
const sleepAdvice = {
  title: '睡眠建议',
  icon: 'Moon',
  color: '#9C27B0',
  items: [
    '建议入睡时间：21:00-21:30',
    '建议睡眠时长：8-10小时',
    '保持规律作息，周末不要过度睡眠',
    '睡前避免使用电子产品',
    '卧室保持黑暗、安静、凉爽'
  ]
};
```

#### 4.8.3 运动建议

```javascript
const exerciseAdvice = {
  title: '运动建议',
  icon: 'Activity',
  color: '#2196F3',
  items: [
    '每日运动30-60分钟，中高强度',
    '推荐运动：跳绳、篮球、游泳、羽毛球',
    '每周至少3次拉伸运动，增加柔韧性',
    '避免过度运动导致疲劳',
    '运动后及时补充水分和营养'
  ]
};
```

#### 4.8.4 医疗建议

```javascript
const medicalAdvice = {
  title: '医疗建议',
  icon: 'Stethoscope',
  color: '#EF5350',
  items: [
    '建议进行骨龄检测，评估生长潜力',
    '定期检查微量元素（钙、铁、锌等）',
    '每3个月测量一次身高和体重',
    '如有异常，建议咨询儿科医生',
    '必要时进行激素水平检测'
  ]
};
```

---

## 第五部分：报告页面详细说明

### 5.1 报告页面总体架构

**页面路由**：`/report/{reportId}` 或 `/report/sample-001`

**页面布局**：
```
┌─────────────────────────────────────────────────────┐
│  导航栏 (ReportNavigation) - 粘性顶部               │
├─────────────────────────────────────────────────────┤
│                                                     │
│  报告内容区 (max-width: 210mm - A4纸宽度)          │
│  ├─ 封面 (ReportCover)                             │
│  ├─ 第1页 (ReportPage1)                            │
│  ├─ 第2页 (ReportPage2)                            │
│  ├─ 第3页 (ReportPage3)                            │
│  ├─ 第4页 (ReportPage4)                            │
│  └─ 封底 (ReportBackCover)                         │
│                                                     │
├─────────────────────────────────────────────────────┤
│  操作按钮区 (右下角固定)                            │
│  ├─ 导出PDF按钮 (ExportPDFButton)                  │
│  └─ 打印按钮 (PrintButton)                         │
└─────────────────────────────────────────────────────┘
```

**页面宽度规范**：
- 报告内容最大宽度：210mm（A4纸张宽度）
- 页面边距：20px
- 页面间距：20px

### 5.2 导航栏详细说明（ReportNavigation）

**位置**：粘性顶部（sticky top-0）
**高度**：60px
**背景**：白色半透明（rgba(255, 255, 255, 0.95)）
**毛玻璃效果**：backdrop-filter: blur(10px)
**下边框**：1px solid #E0E0E0

**导航栏内容**：

```
[← 返回首页] | 儿童姓名 的身高发育测评报告 | 报告编号: GHT-XXXX
```

**各部分样式**：

| 部分 | 样式 | 说明 |
|------|------|------|
| 返回按钮 | 蓝色文字，可点击 | 点击返回首页 |
| 标题 | 16px，#333333 | 儿童姓名 + 报告类型 |
| 报告编号 | 14px，#999999 | 灰色，右对齐 |

---

### 5.3 报告封面详细说明（ReportCover）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#E8F4F8（浅蓝色）
**布局**：垂直居中，水平居中

#### 5.3.1 封面布局结构

```
┌─────────────────────────────────────────┐
│                                         │
│  ┌─────────────────────────────────┐   │
│  │                                 │   │
│  │    [Logo圆形]                   │   │  (距顶部 80px)
│  │    机构名称                     │   │
│  │                                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │                                 │   │
│  │  身高管理专属测评报告           │   │  (中部)
│  │                                 │   │
│  │  儿童姓名（大字）               │   │
│  │  身高发育档案                   │   │
│  │                                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  "科学监测，助力成长，让孩子多长10厘米" │  (底部)
│                                         │
└─────────────────────────────────────────┘
```

#### 5.3.2 封面各元素详细说明

**1. Logo区域**
- 位置：距顶部 80px
- Logo样式：圆形，直径 80px
- Logo背景色：白色（#FFFFFF）
- Logo内部图标：#2A5C8E（深蓝色）
- 图标：生长箭头或身高测量图标
- 机构名称：14px，#2A5C8E，距Logo下方 10px

**2. 主标题区域**
- 位置：页面中部（距顶部约 350px）
- 标题1："身高管理专属测评报告"
  - 字体大小：24px
  - 字体颜色：#2A5C8E
  - 字体粗细：600
  - 字体族：sans-serif
  - 下方间距：30px

**3. 儿童姓名**
- 字体大小：60px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 字体族：sans-serif
- 下方间距：10px

**4. 副标题**
- 文本："身高发育档案"
- 字体大小：20px
- 字体颜色：#666666
- 字体粗细：400
- 下方间距：80px

**5. Slogan区域**
- 位置：距底部 60px
- 文本："科学监测，助力成长，让孩子多长10厘米"
- 字体大小：22px
- 字体颜色：#FFA726（橙色）
- 字体粗细：600
- 背景：半透明白色（rgba(255, 255, 255, 0.3)）
- 内边距：20px 30px
- 圆角：8px
- 文本对齐：居中

---

### 5.4 第1页详细说明（ReportPage1 - 基础信息与遗传背景）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#FFFFFF（白色）
**页面标题**："基础信息与遗传背景"

#### 5.4.1 页面标题样式

- 位置：距顶部 30px
- 字体大小：28px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 下方边框：3px solid #FFA726
- 下方边框宽度：60px
- 下方间距：30px

#### 5.4.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 基础信息与遗传背景                                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────────────┐  ┌──────────────────┐   │
│  │                      │  │                  │   │
│  │   左侧内容（3列）    │  │ 右侧内容（2列）  │   │
│  │                      │  │                  │   │
│  │ 1. 专业测评信息卡    │  │ 1. 遗传靶身高    │   │
│  │ 2. 核心身份信息      │  │    计算          │   │
│  │ 3. 当前体征数据      │  │ 2. 身高尺图形    │   │
│  │                      │  │ 3. 出生信息      │   │
│  │                      │  │                  │   │
│  └──────────────────────┘  └──────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 5.4.3 左侧内容详细说明

**1. 专业测评信息卡**

```
┌─────────────────────────────────┐
│  专业测评 · 科学管理            │
├─────────────────────────────────┤
│ 测评日期 | 报告编号             │
│ YYYY-MM-DD | GHT-XXXX-XXXX      │
└─────────────────────────────────┘
```

- 卡片背景：#F5F5F5（浅灰色）
- 卡片边框：1px solid #E0E0E0
- 卡片圆角：8px
- 卡片内边距：15px
- 标题字体：14px，#2A5C8E，600
- 内容字体：13px，#666666，400
- 下方间距：20px

**2. 核心身份信息**

```
姓名：张小明
性别：男 [蓝色圆形标记]
出生日期：2015-06-15
实足年龄：9岁6个月
```

- 标题字体：14px，#2A5C8E，600
- 内容字体：14px，#333333，400
- 行高：1.8
- 下方间距：20px

**性别标记样式**：
- 男：蓝色圆形（#2196F3），直径 20px
- 女：粉色圆形（#E91E63），直径 20px
- 圆形内文字：白色，12px

**3. 当前体征数据**

```
当前身高
140 cm
[大字体显示]

当前体重：35 kg
BMI指数：17.9（正常）
```

- 标签字体：12px，#999999，400
- 身高数值字体：48px，#2A5C8E，700
- 单位字体：18px，#2A5C8E，400
- 体重/BMI字体：14px，#333333，400
- BMI状态颜色：
  - 正常：#51CF66（绿色）
  - 偏瘦：#FF6B6B（红色）
  - 超重：#FFA726（橙色）
  - 肥胖：#EF5350（深红）

#### 5.4.4 右侧内容详细说明

**1. 遗传靶身高计算卡**

```
┌──────────────────────────────┐
│ 遗传靶身高计算               │
├──────────────────────────────┤
│ 父亲身高：175 cm             │
│ 母亲身高：162 cm             │
├──────────────────────────────┤
│ 遗传身高范围：166.5-183.5 cm │
│ 靶身高：175 cm               │
└──────────────────────────────┘
```

- 卡片背景：#F5F5F5（浅灰色）
- 卡片边框：1px solid #E0E0E0
- 卡片圆角：8px
- 卡片内边距：15px
- 标题字体：14px，#2A5C8E，600
- 内容字体：13px，#333333，400
- 分割线：1px solid #E0E0E0
- 下方间距：20px

**2. 身高尺图形**

```
┌─────────────────────┐
│  身高尺              │
│                     │
│  200cm ─────────    │
│         │ ▲ │       │  (橙色圆点：当前身高)
│  180cm ─────────    │
│         │   │       │  (蓝色虚线：靶身高)
│  160cm ─────────    │
│         │   │       │
│  140cm ─────────    │
│                     │
└─────────────────────┘
```

- 尺图背景：白色
- 尺图边框：1px solid #E0E0E0
- 尺图圆角：8px
- 尺图高度：200px
- 尺图宽度：100px
- 刻度线颜色：#CCCCCC
- 刻度线间距：20px
- 蓝色背景区域：遗传范围（166.5-183.5cm）
- 蓝色背景颜色：#E3F2FD（浅蓝）
- 橙色圆点：当前身高标记，直径 12px，颜色 #FFA726
- 蓝色虚线：靶身高标记，线宽 2px，颜色 #2196F3

**3. 出生信息**

```
出生孕周：40周
出生状态：足月
```

- 标签字体：12px，#999999，400
- 内容字体：14px，#333333，400
- 行高：1.8

---

### 5.5 第2页详细说明（ReportPage2 - 生长曲线可视化分析）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#FFFFFF（白色）
**页面标题**："生长曲线可视化分析"

#### 5.5.1 页面标题样式

- 位置：距顶部 30px
- 字体大小：28px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 下方边框：3px solid #FFA726
- 下方边框宽度：60px
- 下方间距：30px

#### 5.5.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 生长曲线可视化分析                                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  身高生长曲线（0-18岁）                     │   │
│  │  [Recharts LineChart]                       │   │
│  │  高度：300px                                │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  体重生长曲线（0-18岁）                     │   │
│  │  [Recharts LineChart]                       │   │
│  │  高度：200px                                │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌──────────────┬──────────────┬──────────────┐   │
│  │ 当前水平     │ 生长速度     │ 骨龄         │   │
│  │ P50          │ 6.5 cm/年    │ 9岁          │   │
│  └──────────────┴──────────────┴──────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 5.5.3 身高生长曲线图详细说明

**图表配置**：
- 图表类型：Recharts LineChart
- 图表宽度：100%
- 图表高度：300px
- X轴：年龄（0-18岁）
- Y轴：身高（cm）
- 数据点：每年一个点

**WHO标准线**：

| 百分位 | 颜色 | 线宽 | 线型 | 说明 |
|--------|------|------|------|------|
| P3 | #FF6B6B | 1px | 实线 | 下限 |
| P10 | #FFB74D | 1px | 实线 | 下限 |
| P25 | #FFC107 | 1px | 实线 | 下限 |
| P50 | #4CAF50 | 2px | 实线 | 中位数 |
| P75 | #2196F3 | 1px | 实线 | 上限 |
| P90 | #9C27B0 | 1px | 实线 | 上限 |
| P97 | #F44336 | 1px | 实线 | 上限 |

**实测线**：
- 颜色：#FFA726（橙色）
- 线宽：3px
- 线型：实线
- 数据点标记：圆形，直径 6px

**背景区域**：
- P3以下：红色区域（#FFEBEE），透明度 0.3
- P3-P75：绿色区域（#E8F5E9），透明度 0.3
- P75以上：蓝色区域（#E3F2FD），透明度 0.3

**图表交互**：
- 悬停提示：显示年龄、身高、百分位
- 提示框背景：白色，边框 1px solid #E0E0E0
- 提示框内容：年龄、身高值、百分位等级

#### 5.5.4 体重生长曲线图详细说明

**图表配置**：
- 图表类型：Recharts LineChart
- 图表宽度：100%
- 图表高度：200px
- X轴：年龄（0-18岁）
- Y轴：体重（kg）
- 数据点：每年一个点

**样式**：与身高生长曲线图相同

#### 5.5.5 关键指标卡片

```
┌──────────────┬──────────────┬──────────────┐
│ 当前水平     │ 生长速度     │ 骨龄         │
├──────────────┼──────────────┼──────────────┤
│ P50          │ 6.5 cm/年    │ 9岁          │
│ 中位数       │ 正常 ✓       │ 与实足年龄   │
│              │              │ 相符         │
└──────────────┴──────────────┴──────────────┘
```

- 卡片背景：#F5F5F5（浅灰色）
- 卡片边框：1px solid #E0E0E0
- 卡片圆角：8px
- 卡片内边距：15px
- 标题字体：12px，#999999，400
- 内容字体：16px，#333333，600
- 说明字体：12px，#666666，400
- 列间距：15px

**生长速度状态**：
- 正常（5-8 cm/年）：绿色 #51CF66，显示 ✓
- 偏慢（< 5 cm/年）：橙色 #FFA726，显示 ⚠
- 过快（> 8 cm/年）：蓝色 #2196F3，显示 ℹ

---

### 5.6 第3页详细说明（ReportPage3 - 健康影响因素分析）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#FFFFFF（白色）
**页面标题**："健康影响因素分析"

#### 5.6.1 页面标题样式

- 位置：距顶部 30px
- 字体大小：28px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 下方边框：3px solid #FFA726
- 下方边框宽度：60px
- 下方间距：30px

#### 5.6.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 健康影响因素分析                                    │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────────────┐  ┌──────────────────┐   │
│  │                      │  │                  │   │
│  │   左列内容           │  │   右列内容       │   │
│  │                      │  │                  │   │
│  │ 1. 当前主要干预      │  │ 1. 改善意愿      │   │
│  │    阻碍（问题卡片）  │  │    仪表盘        │   │
│  │                      │  │                  │   │
│  │ 2. 生活方式建议表    │  │ 2. 改善建议      │   │
│  │                      │  │    总结          │   │
│  │                      │  │                  │   │
│  └──────────────────────┘  └──────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 5.6.3 左列内容详细说明

**1. 当前主要干预阻碍**

问题卡片示例（根据选中的问题显示）：

```
┌─────────────────────────────┐
│ 🍽️ 挑食                     │
│ 影响营养摄入，需均衡膳食   │
└─────────────────────────────┘
```

**问题卡片样式**：
- 卡片宽度：100%
- 卡片高度：自适应
- 卡片内边距：15px
- 卡片圆角：8px
- 卡片下方间距：12px
- 图标字体大小：24px
- 问题标题字体：16px，600，白色
- 问题描述字体：13px，400，白色
- 背景色映射：

| 问题 | 背景色 | 图标 |
|------|--------|------|
| 挑食 | #FFA726（橙色） | 🍽️ |
| 晚睡 | #9C27B0（紫色） | 🌙 |
| 不爱运动 | #2196F3（蓝色） | 🏃 |
| 厌食 | #EF5350（红色） | 🚫 |
| 情绪问题 | #51CF66（绿色） | 😟 |
| 过度喂养 | #FF6B6B（浅红） | ⚠️ |

**2. 生活方式建议表**

```
┌──────────┬──────────┬──────────────────────┐
│ 维度     │ 目标标准 │ 改善建议             │
├──────────┼──────────┼──────────────────────┤
│ 睡眠     │ 21:00-21:30 │ 晚睡1小时，增加... │
│ 营养     │ 均衡膳食 │ 蛋白质过剩，需要... │
│ 运动     │ 每日30分钟 │ 中高强度运动...   │
│ 情绪     │ 愉悦     │ 心理状态良好...     │
└──────────┴──────────┴──────────────────────┘
```

**表格样式**：
- 表格宽度：100%
- 表格边框：1px solid #E0E0E0
- 表格圆角：8px
- 表头背景：#F5F5F5
- 表头字体：13px，#333333，600
- 表头高度：40px
- 表头内边距：10px
- 行高度：50px
- 行内边距：10px
- 行字体：12px，#666666，400
- 行间分割线：1px solid #F0F0F0
- 奇数行背景：#FFFFFF
- 偶数行背景：#FAFAFA

#### 5.6.4 右列内容详细说明

**1. 家长改善意愿强度仪表盘**

```
        高
       /  \
      /    \
     /  ◆   \
    /        \
   /          \
  ─────────────
   低      中
```

**仪表盘样式**：
- 仪表盘类型：SVG半圆仪表盘
- 仪表盘宽度：200px
- 仪表盘高度：120px
- 背景圆弧颜色：#E0E0E0
- 背景圆弧宽度：8px
- 指针颜色：根据意愿等级变化
- 指针宽度：4px
- 指针长度：80px
- 指针动画：平滑旋转，持续时间 1s

**意愿等级与指针位置**：

| 等级 | 颜色 | 旋转角度 | 说明 |
|------|------|---------|------|
| 低 | #EF5350（红色） | -60° | 左侧 |
| 中 | #FFA726（橙色） | 0° | 中间 |
| 高 | #51CF66（绿色） | 60° | 右侧 |

**仪表盘标签**：
- 左标签："低"，字体 12px，#999999
- 中标签："中"，字体 12px，#999999
- 右标签："高"，字体 12px，#999999
- 标签距仪表盘底部：10px

**2. 改善建议总结**

```
✓ 建议每晚21:00前入睡，保证9小时睡眠
✓ 增加蛋白质、钙质、锌等营养摄入
✓ 每日进行30分钟中高强度运动
✓ 建议进行骨龄检测，评估生长潜力
```

**建议列表样式**：
- 列表项前缀：橙色圆点（●）或对勾（✓）
- 前缀颜色：#FFA726
- 前缀字体大小：16px
- 前缀右间距：10px
- 列表项字体：13px，#333333，400
- 列表项行高：1.8
- 列表项下方间距：10px

---

### 5.7 第4页详细说明（ReportPage4 - 综合评测结论与处方）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#FFFFFF（白色）
**页面标题**："综合评测结论与处方"

#### 5.7.1 页面标题样式

- 位置：距顶部 30px
- 字体大小：28px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 下方边框：3px solid #FFA726
- 下方边框宽度：60px
- 下方间距：30px

#### 5.7.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│ 综合评测结论与处方                                  │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────────────┐  ┌──────────────────┐   │
│  │                      │  │                  │   │
│  │   左列：结论         │  │   右列：处方     │   │
│  │                      │  │                  │   │
│  │ 1. 总体评级          │  │ 1. 处方日期      │   │
│  │ 2. 核心判读          │  │ 2. 四大处方      │   │
│  │                      │  │    - 饮食        │   │
│  │                      │  │    - 睡眠        │   │
│  │                      │  │    - 运动        │   │
│  │                      │  │    - 医疗        │   │
│  │                      │  │                  │   │
│  └──────────────────────┘  └──────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 5.7.3 左列内容详细说明

**1. 总体评级**

```
┌─────────────────┐
│       A         │
│     优秀        │
│ 生长发育状况    │
│   非常好        │
└─────────────────┘
```

**评级圆形样式**：
- 圆形直径：120px
- 圆形背景色：根据评级变化
- 圆形边框：3px solid，颜色同背景
- 评级字母字体：48px，白色，700
- 评级文字字体：18px，白色，600
- 评级描述字体：14px，白色，400
- 圆形下方间距：20px

**评级与颜色映射**：

| 评级 | 背景色 | 文字 | 描述 |
|------|--------|------|------|
| A | #51CF66（绿色） | 优秀 | 生长发育状况非常好 |
| B | #2196F3（蓝色） | 良好 | 生长发育状况良好 |
| C | #FFA726（橙色） | 预警 | 需要关注和干预 |
| D | #EF5350（红色） | 矮小风险 | 建议专业医疗介入 |

**2. 核心判读**

```
┌──────────────────────────────┐
│ 遗传潜力分析                 │
│ 距离靶身高还需增长约 XX cm   │
├──────────────────────────────┤
│ 成年身高预测                 │
│ 预测身高 XXX cm (P50)        │
│ 正常波动范围：XXX-XXX cm     │
│ 预计有望达到遗传靶身高       │
├──────────────────────────────┤
│ 关键风险点                   │
│ [晚睡] [挑食] [运动不足]     │
└──────────────────────────────┘
```

**判读卡片样式**：
- 卡片背景：#F5F5F5（浅灰色）
- 卡片边框：1px solid #E0E0E0
- 卡片圆角：8px
- 卡片内边距：15px
- 卡片下方间距：15px
- 小标题字体：13px，#2A5C8E，600
- 内容字体：13px，#333333，400
- 分割线：1px solid #E0E0E0
- 分割线上下间距：10px

**风险点标签样式**：
- 标签背景：#FFE0E0（浅红）
- 标签文字颜色：#EF5350（红色）
- 标签字体：12px，600
- 标签内边距：6px 12px
- 标签圆角：4px
- 标签间距：8px
- 标签显示方式：行内排列

#### 5.7.4 右列内容详细说明

**1. 处方日期**

```
处方日期：2024-12-15
```

- 标签字体：12px，#999999，400
- 日期字体：14px，#333333，600
- 下方间距：20px

**2. 四大处方类别**

**处方卡片通用样式**：
- 卡片宽度：100%
- 卡片高度：自适应
- 卡片内边距：15px
- 卡片圆角：8px
- 卡片下方间距：15px
- 卡片边框：1px solid，颜色根据类别
- 卡片背景：浅色，根据类别

**处方类别详细说明**：

**① 饮食建议**
```
🍎 饮食建议
├─ 高蛋白食物建议
├─ 钙质补充方案
└─ 微量元素补充
```

- 图标：Apple（🍎）
- 标题颜色：#51CF66（绿色）
- 标题字体：14px，600
- 卡片边框颜色：#51CF66
- 卡片背景颜色：#F1F8E9（浅绿）
- 建议项字体：12px，#333333，400
- 建议项前缀：├─ 或 └─
- 建议项行高：1.6

**② 睡眠建议**
```
🌙 睡眠建议
├─ 入睡时间建议
├─ 睡眠时长建议
└─ 生长激素分泌优化
```

- 图标：Moon（🌙）
- 标题颜色：#9C27B0（紫色）
- 标题字体：14px，600
- 卡片边框颜色：#9C27B0
- 卡片背景颜色：#F3E5F5（浅紫）
- 建议项字体：12px，#333333，400
- 建议项前缀：├─ 或 └─
- 建议项行高：1.6

**③ 运动建议**
```
🏃 运动建议
├─ 运动频率建议
├─ 推荐运动项目
└─ 拉伸运动指导
```

- 图标：Activity（🏃）
- 标题颜色：#2196F3（蓝色）
- 标题字体：14px，600
- 卡片边框颜色：#2196F3
- 卡片背景颜色：#E3F2FD（浅蓝）
- 建议项字体：12px，#333333，400
- 建议项前缀：├─ 或 └─
- 建议项行高：1.6

**④ 医疗建议**
```
⚕️ 医疗建议
├─ 检查项目建议
├─ 专科就诊建议
└─ 监测频率建议
```

- 图标：Stethoscope（⚕️）
- 标题颜色：#EF5350（红色）
- 标题字体：14px，600
- 卡片边框颜色：#EF5350
- 卡片背景颜色：#FFEBEE（浅红）
- 建议项字体：12px，#333333，400
- 建议项前缀：├─ 或 └─
- 建议项行高：1.6

---

### 5.8 封底详细说明（ReportBackCover）

**页面尺寸**：793px × 1122px（A4纸张尺寸）
**背景色**：#E8F4F8（浅蓝色）
**页面标题**："抓住生长发育的黄金期"

#### 5.8.1 页面标题样式

- 位置：距顶部 60px
- 字体大小：32px
- 字体颜色：#2A5C8E
- 字体粗细：700
- 文本对齐：居中
- 下方间距：40px

#### 5.8.2 页面布局

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│  抓住生长发育的黄金期                              │
│                                                     │
│  ┌──────────────┬──────────────┐                   │
│  │              │              │                   │
│  │   第一周     │   第二周     │                   │
│  │              │              │                   │
│  └──────────────┴──────────────┘                   │
│                                                     │
│  ┌──────────────┬──────────────┐                   │
│  │              │              │                   │
│  │   第三周     │   第四周     │                   │
│  │              │              │                   │
│  └──────────────┴──────────────┘                   │
│                                                     │
│  💡 提示：每周坚持执行，可突破自然生长0.3-0.5cm。 │
│  建议在健康管理师指导下制定个性化方案。           │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 5.8.3 四周计划卡片

**卡片布局**：2×2网格

**卡片通用样式**：
- 卡片宽度：calc(50% - 10px)
- 卡片高度：自适应
- 卡片内边距：20px
- 卡片圆角：8px
- 卡片背景：白色
- 卡片边框：2px solid，颜色根据周次
- 卡片间距：20px
- 卡片阴影：0 2px 8px rgba(0,0,0,0.1)

**周次与颜色映射**：

| 周次 | 边框颜色 | 背景色 | 图标 |
|------|---------|--------|------|
| 第一周 | #2196F3（蓝色） | #E3F2FD（浅蓝） | ① |
| 第二周 | #FFA726（橙色） | #FFF3E0（浅橙） | ② |
| 第三周 | #51CF66（绿色） | #E8F5E9（浅绿） | ③ |
| 第四周 | #9C27B0（紫色） | #F3E5F5（浅紫） | ④ |

**卡片内容结构**：

```
┌─────────────────────────────┐
│ ① 第一周                    │
│ 基础评估与准备              │
├─────────────────────────────┤
│ • 建立身高监测日志          │
│ • 评估当前营养状况          │
│ • 制定作息时间表            │
│ • 准备运动器材              │
└─────────────────────────────┘
```

**卡片标题样式**：
- 周次标号字体：20px，颜色根据周次，700
- 周次标题字体：16px，#333333，600
- 标题下方间距：10px
- 分割线：1px solid，颜色根据周次，透明度 0.3

**卡片内容样式**：
- 内容项字体：13px，#333333，400
- 内容项前缀：• （圆点）
- 内容项前缀颜色：颜色根据周次
- 内容项行高：1.8
- 内容项下方间距：8px

**四周计划详细内容**：

**第一周 - 基础评估与准备**
- 建立身高监测日志
- 评估当前营养状况
- 制定作息时间表
- 准备运动器材

**第二周 - 营养与睡眠优化**
- 补充高蛋白食物
- 增加钙质摄入
- 固定睡眠时间
- 优化睡眠环境

**第三周 - 运动强化阶段**
- 每日跳绳30分钟
- 增加摸高训练
- 游泳或篮球运动
- 运动后拉伸15分钟

**第四周 - 综合提升与评估**
- 全面执行综合计划
- 记录生长变化
- 调整干预策略
- 联系顾问反馈

#### 5.8.4 提示信息

```
💡 提示：每周坚持执行，可突破自然生长0.3-0.5cm。
建议在健康管理师指导下制定个性化方案。
```

**提示信息样式**：
- 位置：距底部 40px
- 背景：#FFF9E6（浅黄）
- 边框：1px solid #FFE082（黄色）
- 圆角：8px
- 内边距：15px 20px
- 图标：💡
- 图标字体大小：20px
- 图标右间距：10px
- 文本字体：13px，#F57F17（深黄），400
- 文本行高：1.6
- 文本对齐：左对齐

---

## 第六部分：PDF导出功能详细说明

### 6.1 导出按钮样式（ExportPDFButton）

**按钮位置**：右下角固定（fixed bottom-20 right-20）

**按钮样式**：
- 按钮类型：圆形浮动按钮
- 按钮直径：56px
- 按钮背景色：#2A5C8E（深蓝）
- 按钮图标：Download（下载图标）
- 图标颜色：白色
- 图标大小：24px
- 按钮阴影：0 4px 12px rgba(42, 92, 142, 0.3)
- 按钮悬停效果：
  - 背景色变深：#1A3A5C
  - 阴影增加：0 6px 16px rgba(42, 92, 142, 0.4)
  - 缩放：scale(1.1)
- 按钮过渡动画：all 0.3s ease

### 6.2 导出流程

**用户点击导出按钮**
```
1. 显示进度提示
   "准备导出..."
   ↓
2. 收集报告内容
   - 查找所有报告section元素
   - 克隆HTML结构
   - 移除交互元素（按钮、导航等）
   显示："正在收集报告内容..."
   ↓
3. 优化样式
   - 移除transform属性
   - 移除filter属性
   - 移除box-shadow属性
   - 保留基础样式（颜色、字体、布局等）
   显示："正在生成HTML..."
   ↓
4. 调用后端API
   POST /api/export/pdf
   请求体：{ html: "..." }
   显示："正在调用PDF生成服务..."
   ↓
5. 后端处理
   - 使用JSDOM解析HTML
   - 使用html2canvas转换为Canvas
   - 使用jsPDF生成PDF
   显示："正在下载PDF文件..."
   ↓
6. 下载文件
   - 文件名：儿童姓名_身高发育测评报告_YYYYMMDD.pdf
   - 文件类型：application/pdf
   - 触发浏览器下载
   ↓
7. 完成
   显示成功提示
   "PDF导出成功！"
```

### 6.3 后端PDF生成详细说明

**API端点**：`POST /api/export/pdf`

**请求参数**：
```javascript
{
  html: string  // 完整的HTML文档字符串
}
```

**处理步骤**：

#### 6.3.1 HTML解析
```javascript
const dom = new JSDOM(body.html, {
  runScripts: 'dangerously',
  resources: 'usable',
});
```

#### 6.3.2 样式优化
- 移除transform属性
- 移除filter属性
- 移除box-shadow属性
- 移除animation属性
- 保留：color、background、border、font等基础样式

#### 6.3.3 Canvas转换
```javascript
const canvas = await html2canvas(element, {
  scale: 1.5,           // 高清（1.5倍）
  useCORS: true,        // 允许跨域图片
  backgroundColor: '#ffffff',  // 白色背景
  logging: false,       // 关闭日志
  allowTaint: true,     // 允许污染的canvas
});
```

#### 6.3.4 PDF生成
```javascript
const pdf = new jsPDF({
  orientation: 'portrait',
  unit: 'mm',
  format: 'a4',
});

// 页面配置
const pageWidth = pdf.internal.pageSize.getWidth();   // 210mm
const pageHeight = pdf.internal.pageSize.getHeight(); // 297mm

// 页边距
const margin = {
  top: 15,
  bottom: 15,
  left: 10,
  right: 10,
};

// 计算可用宽度
const availableWidth = pageWidth - margin.left - margin.right;
```

#### 6.3.5 页面处理
- 遍历每个section元素
- 为每个section添加新页
- 添加页眉（标题）
- 添加页脚（页码）
- 计算图片尺寸并插入

**页眉样式**：
- 位置：距顶部 10mm
- 字体大小：10pt
- 字体颜色：#999999
- 内容：儿童姓名 的身高发育测评报告

**页脚样式**：
- 位置：距底部 10mm
- 字体大小：9pt
- 字体颜色：#999999
- 内容：第 X 页 / 共 Y 页

#### 6.3.6 返回响应
```
Content-Type: application/pdf
Content-Disposition: attachment; filename="儿童姓名_身高发育测评报告_YYYYMMDD.pdf"
Body: PDF二进制数据
```

### 6.4 错误处理

**可能的错误**：
1. HTML为空 → 返回400错误，提示"缺少报告内容"
2. Canvas转换失败 → 返回500错误，提示"PDF生成失败，请使用打印功能"
3. PDF生成失败 → 返回500错误，提示"PDF生成失败，请重试"

**降级方案**：
- 如果PDF导出失败，提示用户使用"打印功能"
- 用户可以在打印对话框中选择"另存为PDF"

---

## 第七部分：打印功能详细说明

### 7.1 打印按钮样式（PrintButton）

**按钮位置**：右下角固定（fixed bottom-80 right-20）

**按钮样式**：
- 按钮类型：圆形浮动按钮
- 按钮直径：56px
- 按钮背景色：#FFA726（橙色）
- 按钮图标：Printer（打印机图标）
- 图标颜色：白色
- 图标大小：24px
- 按钮阴影：0 4px 12px rgba(255, 167, 38, 0.3)
- 按钮悬停效果：
  - 背景色变深：#FF9100
  - 阴影增加：0 6px 16px rgba(255, 167, 38, 0.4)
  - 缩放：scale(1.1)
- 按钮过渡动画：all 0.3s ease

### 7.2 打印流程

**用户点击打印按钮**
```
1. 调用浏览器打印功能
   window.print()
   ↓
2. 浏览器打开打印对话框
   - 用户选择打印机
   - 用户配置打印选项
   ↓
3. 用户选择"另存为PDF"
   - 选择保存位置
   - 输入文件名
   ↓
4. 完成
   PDF文件保存到本地
```

### 7.3 打印样式优化

**打印媒体查询**：
```css
@media print {
  /* 隐藏导航栏 */
  nav { display: none; }

  /* 隐藏操作按钮 */
  .export-button, .print-button { display: none; }

  /* 优化页面布局 */
  body { margin: 0; padding: 0; }

  /* 分页符 */
  .report-page { page-break-after: always; }

  /* 保留颜色 */
  * { color-adjust: exact; -webkit-print-color-adjust: exact; }
}
```

---

## 第八部分：数据存储与管理

### 8.1 数据存储方式

**存储位置**：浏览器sessionStorage

**存储键值**：
```
Key: report-{reportId}
Value: JSON格式的完整报告数据
```

**报告ID格式**：
```
GHT-YYYYMMDD-XXXX

示例：GHT-20241215-A1B2

说明：
- GHT：产品代码（Growth Height Test）
- YYYYMMDD：测评日期
- XXXX：随机4位字符（大小写字母+数字）
```

### 8.2 报告数据结构

```javascript
{
  // 基本信息
  reportId: "GHT-20241215-A1B2",
  childName: "张小明",
  gender: "male",
  birthDate: "2015-06-15",
  assessmentDate: "2024-12-15",

  // 当前体征
  currentHeight: 140,
  currentWeight: 35,
  bmi: 17.86,
  bmiStatus: "正常",

  // 年龄信息
  age: {
    years: 9,
    months: 6,
    totalMonths: 114,
    totalDays: 3468
  },

  // 遗传背景
  fatherHeight: 175,
  motherHeight: 162,
  gestationalWeeks: 40,
  isPremature: false,

  // 遗传靶身高
  geneticHeight: {
    targetHeight: 175,
    minHeight: 166.5,
    maxHeight: 183.5,
    range: "166.5-183.5cm"
  },

  // 生长记录
  growthRecords: [
    { age: 0, height: 50, weight: 3.5, source: "who_standard" },
    { age: 1, height: 75, weight: 9.5, source: "who_standard" },
    // ... 更多记录
    { age: 9, height: 140, weight: 35, source: "actual" },
    { age: 9.5, height: 136.75, weight: 33, source: "calculated" }
  ],

  // 生长数据
  annualHeightGrowth: 6.5,
  growthRateStatus: "正常",
  predictedAdultHeight: {
    predicted: 178,
    minHeight: 173,
    maxHeight: 183,
    currentPercentile: "P50-P75",
    confidence: 0.85
  },

  // 健康影响因素
  mainIssues: ["late_sleep", "picky_eating"],
  healthFactors: {
    sleep: {
      issue: "晚睡",
      currentBedtime: "22:30",
      recommendedBedtime: "21:00",
      currentSleepHours: 7,
      recommendedSleepHours: 9,
      impact: "生长激素分泌减少，影响身高增长",
      advice: "建议每晚21:00前入睡，保证9小时睡眠"
    },
    nutrition: {
      issue: "挑食",
      proteinIntake: "low",
      calciumIntake: "low",
      micronutrients: "imbalanced",
      impact: "营养结构不均衡，影响骨骼发育",
      advice: "增加蛋白质、钙质、锌等营养摄入"
    },
    parentWillingness: "high"
  },

  // 综合评测结论
  conclusion: {
    overallRating: "B",
    ratingColor: "#2196F3",
    ratingText: "良好",
    ratingDescription: "生长发育状况良好",
    geneticPotentialGap: 35,
    predictedHeightRange: { min: 173, max: 183 },
    riskFactors: ["晚睡", "挑食"],
    keyInsights: [
      "遗传潜力分析：距离靶身高还需增长约35cm",
      "成年身高预测：预测身高178cm (P50-P75)",
      "预计有望达到遗传靶身高"
    ]
  },

  // 个性化建议
  personalizedAdvice: {
    nutrition: [
      "增加高蛋白食物：鸡蛋、牛奶、鱼类、瘦肉等",
      "补充钙质：牛奶、酸奶、豆制品、绿叶蔬菜",
      "补充锌：牡蛎、瘦肉、坚果、全谷物",
      "均衡膳食：五谷杂粮、蔬菜水果、肉类蛋白",
      "避免过量糖分和油脂"
    ],
    sleep: [
      "建议入睡时间：21:00-21:30",
      "建议睡眠时长：8-10小时",
      "保持规律作息，周末不要过度睡眠",
      "睡前避免使用电子产品",
      "卧室保持黑暗、安静、凉爽"
    ],
    exercise: [
      "每日运动30-60分钟，中高强度",
      "推荐运动：跳绳、篮球、游泳、羽毛球",
      "每周至少3次拉伸运动，增加柔韧性",
      "避免过度运动导致疲劳",
      "运动后及时补充水分和营养"
    ],
    medical: [
      "建议进行骨龄检测，评估生长潜力",
      "定期检查微量元素（钙、铁、锌等）",
      "每3个月测量一次身高和体重",
      "如有异常，建议咨询儿科医生",
      "必要时进行激素水平检测"
    ]
  },

  // 医生建议（可选）
  doctorAdvice: "建议加强营养，保证睡眠",

  // 机构信息
  organization: {
    name: "儿童身高管理中心",
    logo: "logo-url",
    address: "北京市朝阳区",
    phone: "010-12345678"
  },

  // 时间戳
  createdAt: "2024-12-15T10:30:00Z",
  updatedAt: "2024-12-15T10:30:00Z"
}
```

### 8.3 数据持久化

**当前实现**：sessionStorage（会话存储）
- 优点：简单快速，无需后端
- 缺点：刷新页面后数据丢失，无法跨设备访问

**未来改进方案**：
1. 添加数据库存储（PostgreSQL + Drizzle ORM）
2. 实现用户账户系统
3. 支持报告历史记录查询
4. 支持报告分享功能

---

## 第九部分：视觉设计规范总结

### 9.1 色彩系统

**主色系**：
- 深蓝色：#2A5C8E（主要品牌色，用于标题、按钮等）
- 橙色：#FFA726（辅助色，用于强调、Slogan等）

**状态色**：
- 成功/正常：#51CF66（绿色）
- 信息/良好：#2196F3（蓝色）
- 警告/预警：#FFA726（橙色）
- 错误/风险：#EF5350（红色）

**中性色**：
- 背景：#FFFFFF（白色）、#F5F5F5（浅灰）、#FAFAFA（极浅灰）
- 文字：#333333（深灰）、#666666（中灰）、#999999（浅灰）
- 边框：#E0E0E0（浅灰）、#F0F0F0（极浅灰）

**特殊背景**：
- 浅蓝背景：#E8F4F8（用于封面、封底）
- 浅蓝区域：#E3F2FD（用于图表背景）
- 浅绿区域：#E8F5E9（用于正常范围）
- 浅红区域：#FFEBEE（用于风险提示）

### 9.2 字体系统

**字体族**：sans-serif（系统默认无衬线字体）

**字体大小规范**：

| 用途 | 大小 | 粗细 | 行高 |
|------|------|------|------|
| 页面标题 | 28px | 700 | 1.2 |
| 卡片标题 | 16px | 600 | 1.3 |
| 小标题 | 14px | 600 | 1.4 |
| 正文 | 13-14px | 400 | 1.6 |
| 标签 | 12px | 400 | 1.5 |
| 说明文字 | 11-12px | 400 | 1.5 |

### 9.3 间距系统

**基础间距单位**：4px

**常用间距**：
- 极小：4px
- 小：8px
- 中小：12px
- 中：16px
- 中大：20px
- 大：24px
- 极大：32px、40px

**页面间距**：
- 页面顶部间距：30px
- 页面底部间距：30px
- 页面左右间距：20px
- 元素间距：15-20px

### 9.4 圆角规范

- 按钮、输入框：4px
- 卡片、容器：8px
- 圆形元素：50%

### 9.5 阴影规范

- 轻阴影：0 2px 8px rgba(0,0,0,0.1)
- 中阴影：0 4px 12px rgba(0,0,0,0.15)
- 重阴影：0 8px 24px rgba(0,0,0,0.2)

### 9.6 动画规范

- 过渡时间：0.3s
- 缓动函数：ease、ease-in-out
- 悬停效果：背景色变化、阴影增加、缩放

---

## 第十部分：开发实现指南

### 10.1 关键技术点

1. **数据计算**：所有计算必须在前端完成，确保准确性
2. **样式还原**：报告样式必须1:1还原，不能有偏差
3. **PDF导出**：需要处理跨域图片、样式优化等问题
4. **响应式设计**：报告内容宽度固定为A4纸张宽度（210mm）

### 10.2 测试清单

**功能测试**：
- [ ] 表单验证是否正确
- [ ] 数据计算是否准确
- [ ] 报告生成是否完整
- [ ] PDF导出是否成功
- [ ] 打印功能是否正常

**样式测试**：
- [ ] 颜色是否准确
- [ ] 字体大小是否正确
- [ ] 间距是否符合规范
- [ ] 圆角是否正确
- [ ] 阴影是否正确

**兼容性测试**：
- [ ] Chrome浏览器
- [ ] Firefox浏览器
- [ ] Safari浏览器
- [ ] Edge浏览器
- [ ] 移动端浏览器

### 10.3 性能优化

1. 使用React.memo优化组件渲染
2. 使用useMemo缓存计算结果
3. 使用useCallback缓存函数引用
4. 图表数据使用虚拟化技术
5. PDF导出使用Web Worker处理

---

## 附录：常见问题解答

### Q1：报告数据如何保存？
A：当前使用浏览器sessionStorage保存，刷新页面后数据丢失。未来可以添加数据库存储。

### Q2：如何修改报告内容？
A：需要重新填写表单并提交，系统会生成新的报告。

### Q3：PDF导出失败怎么办？
A：可以使用打印功能，在打印对话框中选择"另存为PDF"。

### Q4：报告可以分享吗？
A：当前版本不支持分享，可以通过PDF导出后分享文件。

### Q5：如何自定义机构信息？
A：需要在代码中修改organization配置信息。

---

## 文档更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v1.0 | 2024-12-15 | 初版发布，包含完整功能说明和样式规范 |

---

**文档完成**

本产品功能文档已完整记录了儿童身高发育管理测评报告系统的所有功能、数据结构、样式规范等内容。开发人员可以根据本文档1:1还原系统功能和报告视觉效果。

**严谨性声明**：本文档中的所有样式、颜色、尺寸、字体等参数均为精确值，不可随意更改。报告内容和视觉效果必须与本文档保持一致。





